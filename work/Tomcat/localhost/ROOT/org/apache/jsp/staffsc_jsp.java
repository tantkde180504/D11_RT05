/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/10.1.33
 * Generated at: 2025-07-14 17:27:42 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import jakarta.servlet.*;
import jakarta.servlet.http.*;
import jakarta.servlet.jsp.*;

public final class staffsc_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports,
                 org.apache.jasper.runtime.JspSourceDirectives {

  private static final jakarta.servlet.jsp.JspFactory _jspxFactory =
          jakarta.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.LinkedHashSet<>(4);
    _jspx_imports_packages.add("jakarta.servlet");
    _jspx_imports_packages.add("jakarta.servlet.http");
    _jspx_imports_packages.add("jakarta.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile jakarta.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public boolean getErrorOnELNotFound() {
    return false;
  }

  public jakarta.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final jakarta.servlet.http.HttpServletRequest request, final jakarta.servlet.http.HttpServletResponse response)
      throws java.io.IOException, jakarta.servlet.ServletException {

    if (!jakarta.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final jakarta.servlet.jsp.PageContext pageContext;
    jakarta.servlet.http.HttpSession session = null;
    final jakarta.servlet.ServletContext application;
    final jakarta.servlet.ServletConfig config;
    jakarta.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    jakarta.servlet.jsp.JspWriter _jspx_out = null;
    jakarta.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("<!DOCTYPE html>\n");
      out.write("    <html lang=\"vi\">\n");
      out.write("\n");
      out.write("    <head>\n");
      out.write("        <meta charset=\"UTF-8\">\n");
      out.write("        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n");
      out.write("        <title>Staff Dashboard - 43 Gundam Hobby</title>\n");
      out.write("        <!-- CSS Files -->\n");
      out.write("        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n");
      out.write("        <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\n");
      out.write("        <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap\"\n");
      out.write("            rel=\"stylesheet\">\n");
      out.write("        <link href=\"css/styles.css\" rel=\"stylesheet\">\n");
      out.write("        <link href=\"css/staff-styles.css\" rel=\"stylesheet\">\n");
      out.write("    </head>\n");
      out.write("\n");
      out.write("    <body class=\"staff-body\">\n");
      out.write("        <div class=\"staff-container\">\n");
      out.write("            <!-- Header -->\n");
      out.write("            <div class=\"staff-header\">\n");
      out.write("                <div class=\"row align-items-center\">\n");
      out.write("                    <div class=\"col-md-6\">\n");
      out.write("                        <h1 class=\"mb-0\"><i class=\"fas fa-users-cog text-primary me-3\"></i>Staff Dashboard</h1>\n");
      out.write("                        <p class=\"mb-0 text-muted\">Quản lý hoạt động hỗ trợ khách hàng và vận hành</p>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"col-md-6 text-end\">\n");
      out.write("                        <div class=\"d-flex align-items-center justify-content-end\">\n");
      out.write("                            <div class=\"me-3\">\n");
      out.write("                                <span class=\"text-muted\">Xin chào,</span>\n");
      out.write("                                <strong>Nhân viên ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${staffName}", java.lang.String.class, (jakarta.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("</strong>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"dropdown\">\n");
      out.write("                                <button class=\"btn btn-outline-primary dropdown-toggle\" type=\"button\"\n");
      out.write("                                    data-bs-toggle=\"dropdown\">\n");
      out.write("                                    <i class=\"fas fa-user-circle me-2\"></i>Tài khoản\n");
      out.write("                                </button>\n");
      out.write("                                <ul class=\"dropdown-menu\">\n");
      out.write("                                    <li><a class=\"dropdown-item\" href=\"#\"><i class=\"fas fa-user me-2\"></i>Hồ sơ</a></li>\n");
      out.write("                                    <li><a class=\"dropdown-item\" href=\"#\"><i class=\"fas fa-cog me-2\"></i>Cài đặt</a>\n");
      out.write("                                    </li>\n");
      out.write("                                    <li>\n");
      out.write("                                        <hr class=\"dropdown-divider\">\n");
      out.write("                                    </li>\n");
      out.write("                                    <li><a class=\"dropdown-item\" href=\"#\" onclick=\"logout()\"><i\n");
      out.write("                                                class=\"fas fa-sign-out-alt me-2\"></i>Đăng xuất</a></li>\n");
      out.write("                                </ul>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- ⚠️ Cảnh báo sản phẩm sắp hết -->\n");
      out.write("            <div id=\"low-stock-alert\"\n");
      out.write("                class=\"alert alert-warning d-flex justify-content-between align-items-center mt-3 mx-3\"\n");
      out.write("                style=\"display: none;\">\n");
      out.write("\n");
      out.write("                <span class=\"mb-0\">\n");
      out.write("                    ⚠️ Có <span id=\"low-stock-count\"></span> sản phẩm <strong>sắp hết hàng</strong>.\n");
      out.write("                </span>\n");
      out.write("\n");
      out.write("                <a href=\"#inventory\" data-tab=\"inventory\" onclick=\"viewLowStockProducts()\"\n");
      out.write("                    class=\"btn btn-sm btn-outline-dark ms-3\">\n");
      out.write("                    Xem ngay\n");
      out.write("                </a>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("\n");
      out.write("            <!-- Navigation -->\n");
      out.write("            <div class=\"staff-nav\">\n");
      out.write("                <ul class=\"nav nav-pills justify-content-center\">\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link active\" href=\"#overview\" data-tab=\"overview\">\n");
      out.write("                            <i class=\"fas fa-chart-line me-2\"></i>Tổng quan\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#messages\" data-tab=\"messages\">\n");
      out.write("                            <i class=\"fas fa-comments me-2\"></i>Tin nhắn\n");
      out.write("                            <span class=\"notification-dot\">5</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#complaints\" data-tab=\"complaints\">\n");
      out.write("                            <i class=\"fas fa-exclamation-triangle me-2\"></i>Khiếu nại\n");
      out.write("                            <span class=\"notification-dot\">3</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#inventory\" data-tab=\"inventory\">\n");
      out.write("                            <i class=\"fas fa-boxes me-2\"></i>Tồn kho\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#returns\" data-tab=\"returns\">\n");
      out.write("                            <i class=\"fas fa-undo me-2\"></i>Đổi trả\n");
      out.write("                            <span class=\"notification-dot\">7</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#orders\" data-tab=\"orders\">\n");
      out.write("                            <i class=\"fas fa-shopping-cart me-2\"></i>Đơn hàng\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"nav-item\">\n");
      out.write("                        <a class=\"nav-link\" href=\"#support\" data-tab=\"support\">\n");
      out.write("                            <i class=\"fas fa-life-ring me-2\"></i>Hỗ trợ\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                </ul>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Overview Tab -->\n");
      out.write("            <div id=\"overview\" class=\"tab-content active\">\n");
      out.write("                <!-- Statistics Cards -->\n");
      out.write("                <div class=\"stats-grid\">\n");
      out.write("                    <div class=\"stat-card stat-card-1\">\n");
      out.write("                        <div class=\"icon\"><i class=\"fas fa-comments\"></i></div>\n");
      out.write("                        <div class=\"number\">24</div>\n");
      out.write("                        <div class=\"label\">Tin nhắn chờ xử lý</div>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"stat-card stat-card-2\">\n");
      out.write("                        <div class=\"icon\"><i class=\"fas fa-exclamation-triangle\"></i></div>\n");
      out.write("                        <div class=\"number\">8</div>\n");
      out.write("                        <div class=\"label\">Khiếu nại mới</div>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"stat-card stat-card-3\">\n");
      out.write("                        <div class=\"icon\"><i class=\"fas fa-undo\"></i></div>\n");
      out.write("                        <div class=\"number\">15</div>\n");
      out.write("                        <div class=\"label\">Yêu cầu đổi trả</div>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"stat-card stat-card-4\">\n");
      out.write("                        <div class=\"icon\"><i class=\"fas fa-check-circle\"></i></div>\n");
      out.write("                        <div class=\"number\">156</div>\n");
      out.write("                        <div class=\"label\">Hoàn thành hôm nay</div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("\n");
      out.write("                <!-- Recent Activities -->\n");
      out.write("                <div class=\"row\">\n");
      out.write("                    <div class=\"col-lg-8\">\n");
      out.write("                        <div class=\"staff-card\">\n");
      out.write("                            <h5><i class=\"fas fa-clock me-2 text-primary\"></i>Hoạt động gần đây</h5>\n");
      out.write("                            <div class=\"activity-list\">\n");
      out.write("                                <div class=\"activity-item d-flex align-items-center p-3 border-bottom\">\n");
      out.write("                                    <div class=\"activity-icon bg-primary text-white rounded-circle me-3\">\n");
      out.write("                                        <i class=\"fas fa-comment\"></i>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"flex-grow-1\">\n");
      out.write("                                        <h6 class=\"mb-1\">Tin nhắn mới từ khách hàng</h6>\n");
      out.write("                                        <p class=\"mb-0 text-muted small\">Nguyễn Văn A hỏi về sản phẩm RG Strike Freedom\n");
      out.write("                                        </p>\n");
      out.write("                                        <small class=\"text-muted\">5 phút trước</small>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"activity-item d-flex align-items-center p-3 border-bottom\">\n");
      out.write("                                    <div class=\"activity-icon bg-warning text-white rounded-circle me-3\">\n");
      out.write("                                        <i class=\"fas fa-exclamation\"></i>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"flex-grow-1\">\n");
      out.write("                                        <h6 class=\"mb-1\">Khiếu nại mới</h6>\n");
      out.write("                                        <p class=\"mb-0 text-muted small\">Sản phẩm bị lỗi trong quá trình vận chuyển</p>\n");
      out.write("                                        <small class=\"text-muted\">15 phút trước</small>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"activity-item d-flex align-items-center p-3 border-bottom\">\n");
      out.write("                                    <div class=\"activity-icon bg-info text-white rounded-circle me-3\">\n");
      out.write("                                        <i class=\"fas fa-undo\"></i>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"flex-grow-1\">\n");
      out.write("                                        <h6 class=\"mb-1\">Yêu cầu đổi trả</h6>\n");
      out.write("                                        <p class=\"mb-0 text-muted small\">Đơn hàng #12345 yêu cầu đổi size</p>\n");
      out.write("                                        <small class=\"text-muted\">30 phút trước</small>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"col-lg-4\">\n");
      out.write("                        <div class=\"staff-card\">\n");
      out.write("                            <h5><i class=\"fas fa-chart-pie me-2 text-primary\"></i>Thống kê hôm nay</h5>\n");
      out.write("                            <div class=\"chart-container\" style=\"position: relative; height: 200px; width: 100%;\">\n");
      out.write("                                <canvas id=\"dailyStatsChart\"></canvas>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Messages Tab - Real-time Chat -->\n");
      out.write("            <div id=\"messages\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n");
      out.write("                        <h5><i class=\"fas fa-comments me-2 text-primary\"></i>Chat với khách hàng</h5>\n");
      out.write("                        <div class=\"d-flex gap-2\">\n");
      out.write("                            <span id=\"staff-connection-status\" class=\"badge bg-secondary\">Đang kết nối...</span>\n");
      out.write("                            <button class=\"btn btn-outline-primary btn-sm\" onclick=\"refreshCustomerList()\">\n");
      out.write("                                <i class=\"fas fa-sync-alt me-1\"></i>Làm mới\n");
      out.write("                            </button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"row\">\n");
      out.write("                        <!-- Customer List -->\n");
      out.write("                        <div class=\"col-lg-4\">\n");
      out.write("                            <div class=\"customer-list-container\">\n");
      out.write("                                <div class=\"search-box mb-3\">\n");
      out.write("                                    <i class=\"fas fa-search\"></i>\n");
      out.write("                                    <input type=\"text\" id=\"customer-search\" class=\"form-control\"\n");
      out.write("                                        placeholder=\"Tìm kiếm khách hàng...\">\n");
      out.write("                                </div>\n");
      out.write("\n");
      out.write("                                <div id=\"customer-list\" class=\"customer-list\">\n");
      out.write("                                    <div class=\"text-center p-3 text-muted\">\n");
      out.write("                                        <i class=\"fas fa-users fa-2x mb-2\"></i>\n");
      out.write("                                        <p>Đang tải danh sách khách hàng...</p>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("\n");
      out.write("                        <!-- Chat Area -->\n");
      out.write("                        <div class=\"col-lg-8\">\n");
      out.write("                            <div class=\"chat-area\">\n");
      out.write("                                <!-- Chat Header -->\n");
      out.write("                                <div id=\"chat-header\" class=\"chat-header\" style=\"display: none;\">\n");
      out.write("                                    <div class=\"d-flex align-items-center\">\n");
      out.write("                                        <div class=\"customer-avatar me-3\">\n");
      out.write("                                            <i class=\"fas fa-user\"></i>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div>\n");
      out.write("                                            <h6 class=\"mb-0\" id=\"selected-customer-name\">Chọn khách hàng</h6>\n");
      out.write("                                            <small class=\"text-muted\" id=\"selected-customer-email\"></small>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"chat-status\">\n");
      out.write("                                        <span class=\"badge bg-success\">Online</span>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("\n");
      out.write("                                <!-- Chat Messages -->\n");
      out.write("                                <div id=\"staff-chat-messages\" class=\"chat-messages\">\n");
      out.write("                                    <div class=\"empty-chat\">\n");
      out.write("                                        <i class=\"fas fa-comments fa-3x text-muted mb-3\"></i>\n");
      out.write("                                        <h5 class=\"text-muted\">Chọn khách hàng để bắt đầu chat</h5>\n");
      out.write("                                        <p class=\"text-muted\">Chọn một khách hàng từ danh sách bên trái để bắt đầu hội\n");
      out.write("                                            thoại</p>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("\n");
      out.write("                                <!-- Chat Input -->\n");
      out.write("                                <div id=\"staff-chat-input\" class=\"chat-input\" style=\"display: none;\">\n");
      out.write("                                    <div class=\"input-group\">\n");
      out.write("                                        <input type=\"text\" id=\"staff-message-input\" class=\"form-control\"\n");
      out.write("                                            placeholder=\"Nhập tin nhắn...\" disabled>\n");
      out.write("                                        <button id=\"staff-send-button\" class=\"btn btn-primary\"\n");
      out.write("                                            onclick=\"sendStaffMessage()\" disabled>\n");
      out.write("                                            <i class=\"fas fa-paper-plane\"></i>\n");
      out.write("                                        </button>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Complaints Tab -->\n");
      out.write("            <div id=\"complaints\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n");
      out.write("                        <h5><i class=\"fas fa-exclamation-triangle me-2 text-warning\"></i>Xử lý khiếu nại</h5>\n");
      out.write("                        <select id=\"complaint-status-filter\" class=\"form-select auto-width\">\n");
      out.write("                            <option value=\"\">Tất cả khiếu nại</option>\n");
      out.write("                            <option value=\"PENDING\">Chờ xử lý</option>\n");
      out.write("                            <option value=\"PROCESSING\">Đang xử lý</option>\n");
      out.write("                            <option value=\"COMPLETED\">Đã hoàn thành</option>\n");
      out.write("                            <option value=\"REJECTED\">Từ chối</option>\n");
      out.write("                        </select>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"table-responsive table-modern\">\n");
      out.write("                        <table class=\"table table-hover\">\n");
      out.write("                            <thead>\n");
      out.write("                                <tr>\n");
      out.write("                                    <th>Mã khiếu nại</th>\n");
      out.write("                                    <th>Khách hàng</th>\n");
      out.write("                                    <th>Nội dung</th>\n");
      out.write("                                    <th>Trạng thái</th>\n");
      out.write("                                    <th>Ngày tạo</th>\n");
      out.write("                                    <th>Thao tác</th>\n");
      out.write("                                </tr>\n");
      out.write("                            </thead>\n");
      out.write("                            <tbody id=\"complaint-table-body\">\n");
      out.write("                                <!-- Dữ liệu sẽ được thêm bằng JavaScript -->\n");
      out.write("                            </tbody>\n");
      out.write("                        </table>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Inventory Tab -->\n");
      out.write("            <div id=\"inventory\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n");
      out.write("                        <h5><i class=\"fas fa-boxes me-2 text-info\"></i>Quản lý tồn kho</h5>\n");
      out.write("                        <button class=\"btn btn-primary action-btn\" data-bs-toggle=\"modal\"\n");
      out.write("                            data-bs-target=\"#inventoryModal\">\n");
      out.write("                            <i class=\"fas fa-plus me-2\"></i>Cập nhật tồn kho\n");
      out.write("                        </button>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"row mb-4\">\n");
      out.write("                        <div class=\"col-md-6\">\n");
      out.write("                            <div class=\"search-box\">\n");
      out.write("                                <i class=\"fas fa-search\"></i>\n");
      out.write("                                <input type=\"text\" class=\"form-control\" placeholder=\"Tìm kiếm sản phẩm...\">\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <select class=\"form-select\" id=\"category-filter\">\n");
      out.write("                                <option value=\"\">Tất cả danh mục</option>\n");
      out.write("                                <option value=\"GUNDAM_BANDAI\">GUNDAM_BANDAI</option>\n");
      out.write("                                <option value=\"PRE_ORDER\">PRE_ORDER</option>\n");
      out.write("                                <option value=\"TOOLS_ACCESSORIES\">TOOLS_ACCESSORIES</option>\n");
      out.write("                            </select>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <select class=\"form-select\" id=\"status-filter\">\n");
      out.write("                                <option value=\"\">Tất cả trạng thái</option>\n");
      out.write("                                <option value=\"Còn hàng\">Còn hàng</option>\n");
      out.write("                                <option value=\"Sắp hết\">Sắp hết</option>\n");
      out.write("                                <option value=\"Hết hàng\">Hết hàng</option>\n");
      out.write("                            </select>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"table-responsive table-modern\">\n");
      out.write("                        <table class=\"table table-hover\">\n");
      out.write("                            <thead>\n");
      out.write("                                <tr>\n");
      out.write("                                    <th>Hình ảnh</th>\n");
      out.write("                                    <th>Tên sản phẩm</th>\n");
      out.write("                                    <th>SKU</th>\n");
      out.write("                                    <th>Danh mục</th>\n");
      out.write("                                    <th>Tồn kho</th>\n");
      out.write("                                    <th>Trạng thái</th>\n");
      out.write("                                    <th>Giá</th>\n");
      out.write("                                    <th>Thao tác</th>\n");
      out.write("                                </tr>\n");
      out.write("                            </thead>\n");
      out.write("                            <tbody id=\"inventory-body\">\n");
      out.write("                                <!-- Dữ liệu sẽ được tải từ API bằng JavaScript -->\n");
      out.write("                            </tbody>\n");
      out.write("                        </table>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Returns Tab -->\n");
      out.write("            <div id=\"returns\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n");
      out.write("                        <h5><i class=\"fas fa-undo me-2 text-info\"></i>Xử lý đổi trả</h5>\n");
      out.write("                        <select class=\"form-select auto-width\" id=\"filter-return-status\">\n");
      out.write("                            <option value=\"ALL\">Tất cả yêu cầu</option>\n");
      out.write("                            <option value=\"PROCESSING\">Chờ xử lý</option>\n");
      out.write("                            <option value=\"COMPLETED\">Đã xác nhận</option>\n");
      out.write("                        </select>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"table-responsive table-modern\">\n");
      out.write("                        <table class=\"table table-hover\">\n");
      out.write("                            <thead>\n");
      out.write("                                <tr>\n");
      out.write("                                    <th>Mã đơn hàng</th>\n");
      out.write("                                    <th>Khách hàng</th>\n");
      out.write("                                    <th>Sản phẩm</th>\n");
      out.write("                                    <th>Lý do</th>\n");
      out.write("                                    <th>Trạng thái</th>\n");
      out.write("                                    <th>Yêu cầu</th>\n");
      out.write("                                    <th>Ngày yêu cầu</th>\n");
      out.write("                                    <th>Thao tác</th>\n");
      out.write("                                </tr>\n");
      out.write("                            </thead>\n");
      out.write("                            <tbody id=\"returns-table-body\">\n");
      out.write("                                <!-- Nội dung sẽ được render từ JavaScript -->\n");
      out.write("                            </tbody>\n");
      out.write("                        </table>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Modal Chi Tiết Return -->\n");
      out.write("            <div class=\"modal fade\" id=\"returnModal\" tabindex=\"-1\" aria-labelledby=\"returnModalLabel\"\n");
      out.write("                aria-hidden=\"true\">\n");
      out.write("                <div class=\"modal-dialog modal-dialog-centered\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\" id=\"returnModalLabel\">Chi tiết yêu cầu đổi trả</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Đóng\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <p><strong>Mã đơn hàng:</strong> <span id=\"returnModalOrderNumber\"></span></p>\n");
      out.write("                            <p><strong>Khách hàng:</strong> <span id=\"returnModalUserId\"></span></p>\n");
      out.write("                            <p><strong>Sản phẩm:</strong> <span id=\"returnModalProductId\"></span></p>\n");
      out.write("                            <p><strong>Lý do:</strong> <span id=\"returnModalReason\"></span></p>\n");
      out.write("                            <p><strong>Yêu cầu:</strong> <span id=\"returnModalRequestType\"></span></p>\n");
      out.write("                            <p><strong>Trạng thái:</strong> <span id=\"returnModalStatus\"></span></p>\n");
      out.write("                            <p><strong>Ngày yêu cầu:</strong> <span id=\"returnModalCreatedAt\"></span></p>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-footer\">\n");
      out.write("                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Đóng</button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Orders Tab -->\n");
      out.write("            <div id=\"orders\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <div class=\"d-flex justify-content-between align-items-center mb-4\">\n");
      out.write("                        <h5><i class=\"fas fa-shopping-cart me-2 text-success\"></i>Quản lý đơn hàng</h5>\n");
      out.write("                        <div class=\"d-flex gap-2\">\n");
      out.write("                            <select id=\"order-status-filter\" class=\"form-select auto-width\"\n");
      out.write("                                onchange=\"loadOrdersFromAPI()\">\n");
      out.write("                                <option value=\"ALL\">Tất cả trạng thái</option>\n");
      out.write("                                <option value=\"PENDING\">Chờ xác nhận</option>\n");
      out.write("                                <option value=\"CONFIRMED\">Đã xác nhận</option>\n");
      out.write("                                <option value=\"SHIPPING\">Đang giao</option>\n");
      out.write("                                <option value=\"DELIVERED\">Hoàn thành</option>\n");
      out.write("                                <option value=\"CANCELLED\">Đã huỷ</option>\n");
      out.write("                            </select>\n");
      out.write("                            <button class=\"btn btn-primary action-btn\" data-bs-toggle=\"modal\"\n");
      out.write("                                data-bs-target=\"#orderModal\">\n");
      out.write("                                <i class=\"fas fa-plus me-2\"></i>Tạo đơn hàng\n");
      out.write("                            </button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("\n");
      out.write("                    <div class=\"table-responsive table-modern\">\n");
      out.write("                        <table class=\"table table-hover\" id=\"orders-table\">\n");
      out.write("                            <thead>\n");
      out.write("                                <tr>\n");
      out.write("                                    <th>Mã đơn hàng</th>\n");
      out.write("                                    <th>Khách hàng</th>\n");
      out.write("                                    <th>Sản phẩm</th>\n");
      out.write("                                    <th>Tổng tiền</th>\n");
      out.write("                                    <th>Trạng thái</th>\n");
      out.write("                                    <th>Ngày đặt</th>\n");
      out.write("                                    <th>Thao tác</th>\n");
      out.write("                                </tr>\n");
      out.write("                            </thead>\n");
      out.write("                            <tbody id=\"orders-body\">\n");
      out.write("                                <!-- Dữ liệu sẽ được render từ JavaScript -->\n");
      out.write("                            </tbody>\n");
      out.write("                        </table>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("                <!-- ✅ Modal: Cập nhật trạng thái đơn hàng -->\n");
      out.write("                <div class=\"modal fade\" id=\"updateStatusModal\" tabindex=\"-1\">\n");
      out.write("                    <div class=\"modal-dialog\">\n");
      out.write("                        <div class=\"modal-content\">\n");
      out.write("                            <div class=\"modal-header\">\n");
      out.write("                                <h5 class=\"modal-title\">Cập nhật trạng thái đơn hàng</h5>\n");
      out.write("                                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"modal-body\">\n");
      out.write("                                <input type=\"hidden\" id=\"update-order-id\">\n");
      out.write("                                <div class=\"mb-3\">\n");
      out.write("                                    <label for=\"new-status\" class=\"form-label\">Trạng thái mới:</label>\n");
      out.write("                                    <select class=\"form-select\" id=\"new-status\">\n");
      out.write("                                        <option value=\"PENDING\">Chờ xác nhận</option>\n");
      out.write("                                        <option value=\"CONFIRMED\">Đã xác nhận</option>\n");
      out.write("                                        <option value=\"SHIPPING\">Đang giao</option>\n");
      out.write("                                        <option value=\"DELIVERED\">Hoàn thành</option>\n");
      out.write("                                        <option value=\"CANCELLED\">Đã huỷ</option>\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"modal-footer\">\n");
      out.write("                                <button class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Đóng</button>\n");
      out.write("                                <button class=\"btn btn-primary\" onclick=\"updateOrderStatus()\">Lưu thay đổi</button>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("\n");
      out.write("                <!-- Modal xem chi tiết đơn hàng -->\n");
      out.write("                <div class=\"modal fade\" id=\"orderDetailModal\" tabindex=\"-1\">\n");
      out.write("                    <div class=\"modal-dialog modal-lg\">\n");
      out.write("                        <div class=\"modal-content\">\n");
      out.write("                            <div class=\"modal-header\">\n");
      out.write("                                <h5 class=\"modal-title\">Chi tiết đơn hàng</h5>\n");
      out.write("                                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"modal-body\">\n");
      out.write("                                <div id=\"order-detail-body\">\n");
      out.write("                                    <!-- JavaScript sẽ render nội dung tại đây -->\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"modal-footer\">\n");
      out.write("                                <button class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Đóng</button>\n");
      out.write("                                <button class=\"btn btn-outline-primary\" onclick=\"printInvoice()\">\n");
      out.write("                                    <i class=\"fas fa-print me-1\"></i> In hóa đơn\n");
      out.write("                                </button>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("            <!-- Support Tab -->\n");
      out.write("            <div id=\"support\" class=\"tab-content\">\n");
      out.write("                <div class=\"staff-card\">\n");
      out.write("                    <h5><i class=\"fas fa-life-ring me-2 text-primary\"></i>Hỗ trợ khách hàng</h5>\n");
      out.write("\n");
      out.write("                    <div class=\"row\">\n");
      out.write("                        <div class=\"col-lg-6\">\n");
      out.write("                            <h6><i class=\"fas fa-question-circle me-2\"></i>FAQ Quản lý</h6>\n");
      out.write("                            <div class=\"accordion\" id=\"faqAccordion\">\n");
      out.write("                                <div class=\"accordion-item\">\n");
      out.write("                                    <h2 class=\"accordion-header\">\n");
      out.write("                                        <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\"\n");
      out.write("                                            data-bs-target=\"#faq1\">\n");
      out.write("                                            Làm thế nào để xử lý khiếu nại?\n");
      out.write("                                        </button>\n");
      out.write("                                    </h2>\n");
      out.write("                                    <div id=\"faq1\" class=\"accordion-collapse collapse show\"\n");
      out.write("                                        data-bs-parent=\"#faqAccordion\">\n");
      out.write("                                        <div class=\"accordion-body\">\n");
      out.write("                                            1. Đọc kỹ nội dung khiếu nại<br>\n");
      out.write("                                            2. Liên hệ khách hàng để hiểu rõ vấn đề<br>\n");
      out.write("                                            3. Đưa ra giải pháp phù hợp<br>\n");
      out.write("                                            4. Theo dõi và cập nhật trạng thái\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"accordion-item\">\n");
      out.write("                                    <h2 class=\"accordion-header\">\n");
      out.write("                                        <button class=\"accordion-button collapsed\" type=\"button\"\n");
      out.write("                                            data-bs-toggle=\"collapse\" data-bs-target=\"#faq2\">\n");
      out.write("                                            Quy trình xử lý đổi trả\n");
      out.write("                                        </button>\n");
      out.write("                                    </h2>\n");
      out.write("                                    <div id=\"faq2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#faqAccordion\">\n");
      out.write("                                        <div class=\"accordion-body\">\n");
      out.write("                                            1. Kiểm tra điều kiện đổi trả<br>\n");
      out.write("                                            2. Xác minh tình trạng sản phẩm<br>\n");
      out.write("                                            3. Phê duyệt hoặc từ chối yêu cầu<br>\n");
      out.write("                                            4. Xử lý hoàn tiền/đổi hàng\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"col-lg-6\">\n");
      out.write("                            <h6><i class=\"fas fa-tools me-2\"></i>Công cụ hỗ trợ</h6>\n");
      out.write("                            <div class=\"list-group\">\n");
      out.write("                                <a href=\"#\" class=\"list-group-item list-group-item-action\">\n");
      out.write("                                    <i class=\"fas fa-calculator me-2\"></i>Tính toán phí vận chuyển\n");
      out.write("                                </a>\n");
      out.write("                                <a href=\"#\" class=\"list-group-item list-group-item-action\">\n");
      out.write("                                    <i class=\"fas fa-search me-2\"></i>Tra cứu đơn hàng\n");
      out.write("                                </a>\n");
      out.write("                                <a href=\"#\" class=\"list-group-item list-group-item-action\">\n");
      out.write("                                    <i class=\"fas fa-chart-bar me-2\"></i>Báo cáo thống kê\n");
      out.write("                                </a>\n");
      out.write("                                <a href=\"#\" class=\"list-group-item list-group-item-action\">\n");
      out.write("                                    <i class=\"fas fa-file-export me-2\"></i>Xuất dữ liệu\n");
      out.write("                                </a>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("            <!-- Update Stock Modal -->\n");
      out.write("            <div class=\"modal fade\" id=\"updateStockModal\" tabindex=\"-1\" aria-hidden=\"true\">\n");
      out.write("                <div class=\"modal-dialog\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\"><i class=\"fas fa-edit me-2\"></i>Cập nhật số lượng</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <div class=\"text-center mb-4\">\n");
      out.write("                                <img id=\"update-product-image\" src=\"\" class=\"rounded mb-3\" alt=\"Product\">\n");
      out.write("                                <h6 id=\"update-product-name\">Tên sản phẩm</h6>\n");
      out.write("                                <p class=\"text-muted\">SKU: <span id=\"update-product-sku\">---</span></p>\n");
      out.write("                            </div>\n");
      out.write("\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Số lượng hiện tại</label>\n");
      out.write("                                <input type=\"number\" class=\"form-control\" id=\"current-stock\" readonly>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Số lượng mới</label>\n");
      out.write("                                <input type=\"number\" class=\"form-control\" id=\"new-stock\"\n");
      out.write("                                    placeholder=\"Nhập số lượng mới\">\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Lý do thay đổi</label>\n");
      out.write("                                <textarea class=\"form-control\" rows=\"3\" id=\"update-reason\"\n");
      out.write("                                    placeholder=\"Nhập lý do...\"></textarea>\n");
      out.write("                            </div>\n");
      out.write("                            </form>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-footer\">\n");
      out.write("                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Hủy</button>\n");
      out.write("                            <button id=\"btn-update-stock\" type=\"button\" class=\"btn btn-primary\">Cập nhật</button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("            <!-- Product Detail Modal -->\n");
      out.write("            <div class=\"modal fade\" id=\"productDetailModal\" tabindex=\"-1\">\n");
      out.write("                <div class=\"modal-dialog modal-lg\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\"><i class=\"fas fa-eye me-2\"></i>Chi tiết sản phẩm</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <div class=\"row\">\n");
      out.write("                                <div class=\"col-md-5 text-center\">\n");
      out.write("                                    <img id=\"detail-product-image\" src=\"\" class=\"img-fluid rounded\" alt=\"Ảnh sản phẩm\">\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"col-md-7\">\n");
      out.write("                                    <h4 id=\"detail-product-name\"></h4>\n");
      out.write("                                    <p><strong>SKU:</strong> <span id=\"detail-product-sku\"></span></p>\n");
      out.write("                                    <p><strong>Giá:</strong> <span id=\"detail-product-price\"></span></p>\n");
      out.write("                                    <p><strong>Danh mục:</strong> <span id=\"detail-product-category\"></span></p>\n");
      out.write("                                    <p><strong>Grade:</strong> <span id=\"detail-product-grade\"></span></p>\n");
      out.write("                                    <p><strong>Thương hiệu:</strong> <span id=\"detail-product-brand\"></span></p>\n");
      out.write("                                    <p><strong>Tồn kho:</strong> <span id=\"detail-product-stock\"></span></p>\n");
      out.write("                                    <p><strong>Mô tả:</strong><br><span id=\"detail-product-desc\"></span></p>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("\n");
      out.write("        <!-- Quick Actions -->\n");
      out.write("        <div class=\"quick-actions\">\n");
      out.write("            <button class=\"quick-action-btn d-block\" title=\"Tin nhắn nhanh\" data-bs-toggle=\"modal\"\n");
      out.write("                data-bs-target=\"#quickMessageModal\">\n");
      out.write("                <i class=\"fas fa-comment\"></i>\n");
      out.write("            </button>\n");
      out.write("            <button class=\"quick-action-btn d-block\" title=\"Gọi điện\">\n");
      out.write("                <i class=\"fas fa-phone\"></i>\n");
      out.write("            </button>\n");
      out.write("            <button class=\"quick-action-btn d-block\" title=\"Ghi chú\">\n");
      out.write("                <i class=\"fas fa-sticky-note\"></i>\n");
      out.write("            </button>\n");
      out.write("        </div>\n");
      out.write("\n");
      out.write("        <!-- Modals -->\n");
      out.write("        <!-- Compose Message Modal -->\n");
      out.write("        <div class=\"modal fade modal-modern\" id=\"composeModal\" tabindex=\"-1\">\n");
      out.write("            <div class=\"modal-dialog modal-lg\">\n");
      out.write("                <div class=\"modal-content\">\n");
      out.write("                    <div class=\"modal-header\">\n");
      out.write("                        <h5 class=\"modal-title\"><i class=\"fas fa-edit me-2\"></i>Soạn tin nhắn mới</h5>\n");
      out.write("                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-body\">\n");
      out.write("                        <form>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Người nhận</label>\n");
      out.write("                                <input type=\"email\" class=\"form-control\" placeholder=\"email@example.com\">\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Tiêu đề</label>\n");
      out.write("                                <input type=\"text\" class=\"form-control\" placeholder=\"Nhập tiêu đề...\">\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Nội dung</label>\n");
      out.write("                                <textarea class=\"form-control\" rows=\"6\"\n");
      out.write("                                    placeholder=\"Nhập nội dung tin nhắn...\"></textarea>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"mb-3\">\n");
      out.write("                                <label class=\"form-label\">Mức độ ưu tiên</label>\n");
      out.write("                                <select class=\"form-select\">\n");
      out.write("                                    <option>Bình thường</option>\n");
      out.write("                                    <option>Cao</option>\n");
      out.write("                                    <option>Thấp</option>\n");
      out.write("                                </select>\n");
      out.write("                            </div>\n");
      out.write("                        </form>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-footer\">\n");
      out.write("                        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Hủy</button>\n");
      out.write("                        <button type=\"button\" class=\"btn btn-primary\">Gửi tin nhắn</button>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("\n");
      out.write("        <!-- Complaint Detail Modal -->\n");
      out.write("        <div class=\"modal fade modal-modern\" id=\"complaintModal\" tabindex=\"-1\">\n");
      out.write("            <div class=\"modal-dialog modal-xl\">\n");
      out.write("                <div class=\"modal-content\">\n");
      out.write("                    <div class=\"modal-header\">\n");
      out.write("                        <h5 class=\"modal-title\">\n");
      out.write("                            <i class=\"fas fa-exclamation-triangle me-2\"></i>Chi tiết khiếu nại\n");
      out.write("                        </h5>\n");
      out.write("                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-body\">\n");
      out.write("                        <div class=\"row\">\n");
      out.write("                            <!-- Thông tin khiếu nại -->\n");
      out.write("                            <div class=\"col-md-8\">\n");
      out.write("                                <div class=\"card\">\n");
      out.write("                                    <div class=\"card-header\">\n");
      out.write("                                        <h6><i class=\"fas fa-info-circle me-2\"></i>Thông tin khiếu nại</h6>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"card-body\">\n");
      out.write("                                        <div class=\"row\">\n");
      out.write("                                            <div class=\"col-md-6\">\n");
      out.write("                                                <p><strong>Khách hàng:</strong> <span\n");
      out.write("                                                        id=\"complaint-customer-name\"></span></p>\n");
      out.write("                                                <p><strong>Email:</strong> <span id=\"complaint-email\"></span></p>\n");
      out.write("                                                <p><strong>Điện thoại:</strong> <span id=\"complaint-phone\"></span>\n");
      out.write("                                                </p>\n");
      out.write("                                                <p><strong>Đơn hàng:</strong> <span id=\"complaint-order-number\"></span>\n");
      out.write("                                                </p>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"col-md-6\">\n");
      out.write("                                                <p><strong>Ngày tạo:</strong> <span id=\"complaint-created-at\"></span>\n");
      out.write("                                                </p>\n");
      out.write("                                                <p><strong>Lí do:</strong> <span id=\"complaint-category\"></span></p>\n");
      out.write("                                                <p><strong>Trạng thái:</strong> <span id=\"complaint-status\"></span>\n");
      out.write("                                                </p>\n");
      out.write("                                            </div>\n");
      out.write("                                        </div>\n");
      out.write("                                        <hr>\n");
      out.write("                                        <h6>Nội dung khiếu nại:</h6>\n");
      out.write("                                        <p id=\"complaint-content\"></p>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("\n");
      out.write("                            <!-- Phản hồi & xử lý -->\n");
      out.write("                            <div class=\"col-md-4\">\n");
      out.write("                                <div class=\"card\">\n");
      out.write("                                    <div class=\"card-header\">\n");
      out.write("                                        <h6><i class=\"fas fa-cog me-2\"></i>Phản hồi & giải pháp</h6>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"card-body\">\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Giải pháp</label>\n");
      out.write("                                            <select class=\"form-select\" id=\"complaint-solution\">\n");
      out.write("                                                <option value=\"\">-- Chọn giải pháp --</option>\n");
      out.write("                                                <option>Đổi sản phẩm mới</option>\n");
      out.write("                                                <option>Hoàn tiền</option>\n");
      out.write("                                                <option>Sửa chữa</option>\n");
      out.write("                                                <option>Giảm giá đơn hàng tiếp theo</option>\n");
      out.write("                                            </select>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Phản hồi nhân viên</label>\n");
      out.write("                                            <textarea class=\"form-control\" id=\"complaint-staff-response\" rows=\"4\"\n");
      out.write("                                                placeholder=\"Nhập phản hồi...\"></textarea>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"d-flex gap-2\">\n");
      out.write("                                            <button class=\"btn btn-success w-50\"\n");
      out.write("                                                onclick=\"handleComplaintUpdate('PROCESSING')\">\n");
      out.write("                                                <i class=\"fas fa-check me-1\"></i>Phê duyệt\n");
      out.write("                                            </button>\n");
      out.write("                                            <button class=\"btn btn-danger w-50\"\n");
      out.write("                                                onclick=\"handleComplaintUpdate('REJECTED')\">\n");
      out.write("                                                <i class=\"fas fa-times me-1\"></i>Từ chối\n");
      out.write("                                            </button>\n");
      out.write("                                        </div>\n");
      out.write("\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("\n");
      out.write("\n");
      out.write("        <!-- Inventory Update Modal -->\n");
      out.write("        <div class=\"modal fade modal-modern\" id=\"inventoryModal\" tabindex=\"-1\">\n");
      out.write("            <div class=\"modal-dialog modal-lg\">\n");
      out.write("                <div class=\"modal-content\">\n");
      out.write("                    <div class=\"modal-header\">\n");
      out.write("                        <h5 class=\"modal-title\"><i class=\"fas fa-plus me-2\"></i>Cập nhật tồn kho</h5>\n");
      out.write("                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-body\">\n");
      out.write("                        <form>\n");
      out.write("                            <div class=\"row\">\n");
      out.write("                                <div class=\"col-md-6\">\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Sản phẩm</label>\n");
      out.write("                                        <select class=\"form-select\">\n");
      out.write("                                            <option>Chọn sản phẩm...</option>\n");
      out.write("                                            <option>RG Strike Freedom Gundam</option>\n");
      out.write("                                            <option>MG Barbatos</option>\n");
      out.write("                                            <option>PG Unicorn Gundam</option>\n");
      out.write("                                        </select>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Loại cập nhật</label>\n");
      out.write("                                        <select class=\"form-select\">\n");
      out.write("                                            <option>Nhập kho</option>\n");
      out.write("                                            <option>Xuất kho</option>\n");
      out.write("                                            <option>Điều chỉnh</option>\n");
      out.write("                                            <option>Kiểm kê</option>\n");
      out.write("                                        </select>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Số lượng</label>\n");
      out.write("                                        <input type=\"number\" class=\"form-control\" placeholder=\"0\">\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"col-md-6\">\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Lý do</label>\n");
      out.write("                                        <select class=\"form-select\">\n");
      out.write("                                            <option>Nhập hàng mới</option>\n");
      out.write("                                            <option>Bán hàng</option>\n");
      out.write("                                            <option>Hàng lỗi</option>\n");
      out.write("                                            <option>Mất mát</option>\n");
      out.write("                                            <option>Khác</option>\n");
      out.write("                                        </select>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Ghi chú</label>\n");
      out.write("                                        <textarea class=\"form-control\" rows=\"3\"\n");
      out.write("                                            placeholder=\"Nhập ghi chú...\"></textarea>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"mb-3\">\n");
      out.write("                                        <label class=\"form-label\">Ngày hiệu lực</label>\n");
      out.write("                                        <input type=\"date\" class=\"form-control\" value=\"2024-03-15\">\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </form>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-footer\">\n");
      out.write("                        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Hủy</button>\n");
      out.write("                        <button type=\"button\" class=\"btn btn-primary\">Cập nhật tồn kho</button>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("\n");
      out.write("\n");
      out.write("        <!-- Return Detail Modal -->\n");
      out.write("        <div class=\"modal fade modal-modern\" id=\"returnModal\" tabindex=\"-1\">\n");
      out.write("            <div class=\"modal-dialog modal-lg\">\n");
      out.write("                <div class=\"modal-content\">\n");
      out.write("                    <div class=\"modal-header\">\n");
      out.write("                        <h5 class=\"modal-title\"><i class=\"fas fa-undo me-2\"></i>Chi tiết yêu cầu đổi trả #12345</h5>\n");
      out.write("                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"modal-body\">\n");
      out.write("                        <div class=\"row\">\n");
      out.write("                            <div class=\"col-md-8\">\n");
      out.write("                                <div class=\"card\">\n");
      out.write("                                    <div class=\"card-header\">\n");
      out.write("                                        <h6><i class=\"fas fa-shopping-cart me-2\"></i>Thông tin đơn hàng</h6>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"card-body\">\n");
      out.write("                                        <div class=\"row\">\n");
      out.write("                                            <div class=\"col-md-6\">\n");
      out.write("                                                <p><strong>Mã đơn hàng:</strong> #12345</p>\n");
      out.write("                                                <p><strong>Khách hàng:</strong> Nguyễn Văn A</p>\n");
      out.write("                                                <p><strong>Email:</strong> customer@email.com</p>\n");
      out.write("                                                <p><strong>Sản phẩm:</strong> RG Strike Freedom Gundam</p>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"col-md-6\">\n");
      out.write("                                                <p><strong>Ngày mua:</strong> 10/03/2024</p>\n");
      out.write("                                                <p><strong>Ngày yêu cầu:</strong> 15/03/2024</p>\n");
      out.write("                                                <p><strong>Giá trị:</strong> 850,000₫</p>\n");
      out.write("                                                <p><strong>Trạng thái:</strong> <span\n");
      out.write("                                                        class=\"status-badge status-pending\">Chờ xử lý</span></p>\n");
      out.write("                                            </div>\n");
      out.write("                                        </div>\n");
      out.write("                                        <hr>\n");
      out.write("                                        <h6>Lý do đổi trả:</h6>\n");
      out.write("                                        <p>Sản phẩm bị lỗi khi nhận hàng. Một số chi tiết bị gãy và hộp bị móp méo.\n");
      out.write("                                        </p>\n");
      out.write("\n");
      out.write("                                        <h6 class=\"mt-3\">Hình ảnh:</h6>\n");
      out.write("                                        <div class=\"d-flex gap-2\">\n");
      out.write("                                            <img src=\"https://via.placeholder.com/80x80\" class=\"rounded\"\n");
      out.write("                                                alt=\"Return evidence\">\n");
      out.write("                                            <img src=\"https://via.placeholder.com/80x80\" class=\"rounded\"\n");
      out.write("                                                alt=\"Return evidence\">\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"col-md-4\">\n");
      out.write("                                <div class=\"card\">\n");
      out.write("                                    <div class=\"card-header\">\n");
      out.write("                                        <h6><i class=\"fas fa-cogs me-2\"></i>Xử lý yêu cầu</h6>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"card-body\">\n");
      out.write("                                        <form>\n");
      out.write("                                            <div class=\"mb-3\">\n");
      out.write("                                                <label class=\"form-label\">Quyết định</label>\n");
      out.write("                                                <select class=\"form-select\">\n");
      out.write("                                                    <option>Chọn quyết định...</option>\n");
      out.write("                                                    <option>Phê duyệt đổi hàng</option>\n");
      out.write("                                                    <option>Phê duyệt hoàn tiền</option>\n");
      out.write("                                                    <option>Từ chối</option>\n");
      out.write("                                                    <option>Yêu cầu thêm thông tin</option>\n");
      out.write("                                                </select>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"mb-3\">\n");
      out.write("                                                <label class=\"form-label\">Ghi chú</label>\n");
      out.write("                                                <textarea class=\"form-control\" rows=\"4\"\n");
      out.write("                                                    placeholder=\"Nhập ghi chú xử lý...\"></textarea>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"mb-3\">\n");
      out.write("                                                <label class=\"form-label\">Phí xử lý</label>\n");
      out.write("                                                <input type=\"number\" class=\"form-control\" placeholder=\"0\" value=\"0\">\n");
      out.write("                                            </div>\n");
      out.write("                                            <button type=\"button\" class=\"btn btn-success w-100 mb-2\">Phê\n");
      out.write("                                                duyệt</button>\n");
      out.write("                                            <button type=\"button\" class=\"btn btn-danger w-100\">Từ chối</button>\n");
      out.write("                                        </form>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Order Detail Modal -->\n");
      out.write("            <div class=\"modal fade modal-modern\" id=\"orderDetailModal\" tabindex=\"-1\">\n");
      out.write("                <div class=\"modal-dialog modal-xl\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\"><i class=\"fas fa-shopping-cart me-2\"></i>Chi tiết đơn hàng\n");
      out.write("                                #ORD001</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <div class=\"row\">\n");
      out.write("                                <div class=\"col-md-8\">\n");
      out.write("                                    <div class=\"card\">\n");
      out.write("                                        <div class=\"card-header\">\n");
      out.write("                                            <h6><i class=\"fas fa-list me-2\"></i>Sản phẩm trong đơn hàng</h6>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"card-body\">\n");
      out.write("                                            <div class=\"table-responsive\">\n");
      out.write("                                                <table class=\"table table-sm\">\n");
      out.write("                                                    <thead>\n");
      out.write("                                                        <tr>\n");
      out.write("                                                            <th>Sản phẩm</th>\n");
      out.write("                                                            <th>SKU</th>\n");
      out.write("                                                            <th>Số lượng</th>\n");
      out.write("                                                            <th>Đơn giá</th>\n");
      out.write("                                                            <th>Thành tiền</th>\n");
      out.write("                                                        </tr>\n");
      out.write("                                                    </thead>\n");
      out.write("                                                    <tbody>\n");
      out.write("                                                        <tr>\n");
      out.write("                                                            <td>\n");
      out.write("                                                                <div class=\"d-flex align-items-center\">\n");
      out.write("                                                                    <img src=\"https://via.placeholder.com/40x40\"\n");
      out.write("                                                                        class=\"rounded me-2\">\n");
      out.write("                                                                    <span>RG Strike Freedom Gundam</span>\n");
      out.write("                                                                </div>\n");
      out.write("                                                            </td>\n");
      out.write("                                                            <td>RG-001</td>\n");
      out.write("                                                            <td>1</td>\n");
      out.write("                                                            <td>850,000₫</td>\n");
      out.write("                                                            <td>850,000₫</td>\n");
      out.write("                                                        </tr>\n");
      out.write("                                                        <tr>\n");
      out.write("                                                            <td>\n");
      out.write("                                                                <div class=\"d-flex align-items-center\">\n");
      out.write("                                                                    <img src=\"https://via.placeholder.com/40x40\"\n");
      out.write("                                                                        class=\"rounded me-2\">\n");
      out.write("                                                                    <span>Gundam Panel Line Marker</span>\n");
      out.write("                                                                </div>\n");
      out.write("                                                            </td>\n");
      out.write("                                                            <td>TOOL-001</td>\n");
      out.write("                                                            <td>1</td>\n");
      out.write("                                                            <td>100,000₫</td>\n");
      out.write("                                                            <td>100,000₫</td>\n");
      out.write("                                                        </tr>\n");
      out.write("                                                    </tbody>\n");
      out.write("                                                </table>\n");
      out.write("                                            </div>\n");
      out.write("                                            <hr>\n");
      out.write("                                            <div class=\"row\">\n");
      out.write("                                                <div class=\"col-md-6\">\n");
      out.write("                                                    <h6>Thông tin khách hàng:</h6>\n");
      out.write("                                                    <p><strong>Tên:</strong> Nguyễn Văn A</p>\n");
      out.write("                                                    <p><strong>Email:</strong> customer@email.com</p>\n");
      out.write("                                                    <p><strong>Điện thoại:</strong> 0123456789</p>\n");
      out.write("                                                </div>\n");
      out.write("                                                <div class=\"col-md-6\">\n");
      out.write("                                                    <h6>Địa chỉ giao hàng:</h6>\n");
      out.write("                                                    <p>123 Đường ABC, Quận 1<br>TP. Hồ Chí Minh<br>Việt Nam</p>\n");
      out.write("                                                </div>\n");
      out.write("                                            </div>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"col-md-4\">\n");
      out.write("                                    <div class=\"card\">\n");
      out.write("                                        <div class=\"card-header\">\n");
      out.write("                                            <h6><i class=\"fas fa-info-circle me-2\"></i>Thông tin đơn hàng</h6>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"card-body\">\n");
      out.write("                                            <p><strong>Mã đơn hàng:</strong> #ORD001</p>\n");
      out.write("                                            <p><strong>Ngày đặt:</strong> 15/03/2024</p>\n");
      out.write("                                            <p><strong>Trạng thái:</strong> <span\n");
      out.write("                                                    class=\"status-badge status-pending\">Chờ xác nhận</span></p>\n");
      out.write("                                            <p><strong>Phương thức thanh toán:</strong> COD</p>\n");
      out.write("                                            <hr>\n");
      out.write("                                            <div class=\"d-flex justify-content-between\">\n");
      out.write("                                                <span>Tạm tính:</span>\n");
      out.write("                                                <span>950,000₫</span>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"d-flex justify-content-between\">\n");
      out.write("                                                <span>Phí vận chuyển:</span>\n");
      out.write("                                                <span>0₫</span>\n");
      out.write("                                            </div>\n");
      out.write("                                            <div class=\"d-flex justify-content-between\">\n");
      out.write("                                                <span>Giảm giá:</span>\n");
      out.write("                                                <span>0₫</span>\n");
      out.write("                                            </div>\n");
      out.write("                                            <hr>\n");
      out.write("                                            <div class=\"d-flex justify-content-between\">\n");
      out.write("                                                <strong>Tổng cộng:</strong>\n");
      out.write("                                                <strong>950,000₫</strong>\n");
      out.write("                                            </div>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("\n");
      out.write("                                    <div class=\"card mt-3\">\n");
      out.write("                                        <div class=\"card-header\">\n");
      out.write("                                            <h6><i class=\"fas fa-truck me-2\"></i>Cập nhật trạng thái</h6>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"card-body\">\n");
      out.write("                                            <form>\n");
      out.write("                                                <div class=\"mb-3\">\n");
      out.write("                                                    <label class=\"form-label\">Trạng thái mới</label>\n");
      out.write("                                                    <select class=\"form-select\">\n");
      out.write("                                                        <option>Chờ xác nhận</option>\n");
      out.write("                                                        <option>Đã xác nhận</option>\n");
      out.write("                                                        <option>Đang chuẩn bị</option>\n");
      out.write("                                                        <option>Đang giao</option>\n");
      out.write("                                                        <option>Hoàn thành</option>\n");
      out.write("                                                        <option>Đã hủy</option>\n");
      out.write("                                                    </select>\n");
      out.write("                                                </div>\n");
      out.write("                                                <div class=\"mb-3\">\n");
      out.write("                                                    <label class=\"form-label\">Ghi chú</label>\n");
      out.write("                                                    <textarea class=\"form-control\" rows=\"3\"\n");
      out.write("                                                        placeholder=\"Ghi chú cập nhật...\"></textarea>\n");
      out.write("                                                </div>\n");
      out.write("                                                <button type=\"button\" class=\"btn btn-primary w-100\">Cập nhật trạng\n");
      out.write("                                                    thái</button>\n");
      out.write("                                            </form>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Create Order Modal -->\n");
      out.write("            <div class=\"modal fade modal-modern\" id=\"orderModal\" tabindex=\"-1\">\n");
      out.write("                <div class=\"modal-dialog modal-lg\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\"><i class=\"fas fa-plus me-2\"></i>Tạo đơn hàng mới</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <form>\n");
      out.write("                                <div class=\"row\">\n");
      out.write("                                    <div class=\"col-md-6\">\n");
      out.write("                                        <h6><i class=\"fas fa-user me-2\"></i>Thông tin khách hàng</h6>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Họ tên</label>\n");
      out.write("                                            <input type=\"text\" class=\"form-control\" placeholder=\"Nhập họ tên...\">\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Email</label>\n");
      out.write("                                            <input type=\"email\" class=\"form-control\" placeholder=\"email@example.com\">\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Điện thoại</label>\n");
      out.write("                                            <input type=\"tel\" class=\"form-control\" placeholder=\"0123456789\">\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Địa chỉ</label>\n");
      out.write("                                            <textarea class=\"form-control\" rows=\"3\"\n");
      out.write("                                                placeholder=\"Nhập địa chỉ giao hàng...\"></textarea>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                    <div class=\"col-md-6\">\n");
      out.write("                                        <h6><i class=\"fas fa-box me-2\"></i>Sản phẩm</h6>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Chọn sản phẩm</label>\n");
      out.write("                                            <select class=\"form-select\">\n");
      out.write("                                                <option>Chọn sản phẩm...</option>\n");
      out.write("                                                <option>RG Strike Freedom Gundam - 850,000₫</option>\n");
      out.write("                                                <option>MG Barbatos - 1,200,000₫</option>\n");
      out.write("                                                <option>PG Unicorn Gundam - 4,500,000₫</option>\n");
      out.write("                                            </select>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Số lượng</label>\n");
      out.write("                                            <input type=\"number\" class=\"form-control\" value=\"1\" min=\"1\">\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Phương thức thanh toán</label>\n");
      out.write("                                            <select class=\"form-select\">\n");
      out.write("                                                <option>COD (Thanh toán khi nhận hàng)</option>\n");
      out.write("                                                <option>Chuyển khoản</option>\n");
      out.write("                                                <option>Ví điện tử</option>\n");
      out.write("                                            </select>\n");
      out.write("                                        </div>\n");
      out.write("                                        <div class=\"mb-3\">\n");
      out.write("                                            <label class=\"form-label\">Ghi chú</label>\n");
      out.write("                                            <textarea class=\"form-control\" rows=\"3\"\n");
      out.write("                                                placeholder=\"Ghi chú đơn hàng...\"></textarea>\n");
      out.write("                                        </div>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("                            </form>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-footer\">\n");
      out.write("                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Hủy</button>\n");
      out.write("                            <button type=\"button\" class=\"btn btn-primary\">Tạo đơn hàng</button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <!-- Quick Message Modal -->\n");
      out.write("            <div class=\"modal fade modal-modern\" id=\"quickMessageModal\" tabindex=\"-1\">\n");
      out.write("                <div class=\"modal-dialog\">\n");
      out.write("                    <div class=\"modal-content\">\n");
      out.write("                        <div class=\"modal-header\">\n");
      out.write("                            <h5 class=\"modal-title\"><i class=\"fas fa-bolt me-2\"></i>Tin nhắn nhanh</h5>\n");
      out.write("                            <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-body\">\n");
      out.write("                            <form>\n");
      out.write("                                <div class=\"mb-3\">\n");
      out.write("                                    <label class=\"form-label\">Mẫu tin nhắn</label>\n");
      out.write("                                    <select class=\"form-select\" id=\"messageTemplate\">\n");
      out.write("                                        <option value=\"\">Chọn mẫu tin nhắn...</option>\n");
      out.write("                                        <option value=\"order_confirm\">Xác nhận đơn hàng</option>\n");
      out.write("                                        <option value=\"shipping_info\">Thông tin vận chuyển</option>\n");
      out.write("                                        <option value=\"thank_you\">Cảm ơn khách hàng</option>\n");
      out.write("                                        <option value=\"follow_up\">Theo dõi sau bán hàng</option>\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"mb-3\">\n");
      out.write("                                    <label class=\"form-label\">Người nhận</label>\n");
      out.write("                                    <input type=\"email\" class=\"form-control\" placeholder=\"email@example.com\">\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"mb-3\">\n");
      out.write("                                    <label class=\"form-label\">Nội dung</label>\n");
      out.write("                                    <textarea class=\"form-control\" rows=\"5\" id=\"messageContent\"\n");
      out.write("                                        placeholder=\"Nhập nội dung tin nhắn...\"></textarea>\n");
      out.write("                                </div>\n");
      out.write("                            </form>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"modal-footer\">\n");
      out.write("                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Hủy</button>\n");
      out.write("                            <button type=\"button\" class=\"btn btn-primary\">Gửi tin nhắn</button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div> <!-- Scripts -->\n");
      out.write("        <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n");
      out.write("        <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n");
      out.write("        <script src=\"js/staff.js\"></script>\n");
      out.write("        <script src=\"");
      out.print(request.getContextPath());
      out.write("/js/auth.js\"></script>\n");
      out.write("\n");
      out.write("        <!-- Chat WebSocket Scripts -->\n");
      out.write("        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js\"></script>\n");
      out.write("        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js\"></script>\n");
      out.write("\n");
      out.write("        <style>\n");
      out.write("            /* Staff Chat Styles */\n");
      out.write("            .customer-list-container {\n");
      out.write("                border: 1px solid #e0e0e0;\n");
      out.write("                border-radius: 8px;\n");
      out.write("                height: 500px;\n");
      out.write("                overflow: hidden;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-list {\n");
      out.write("                height: calc(100% - 60px);\n");
      out.write("                overflow-y: auto;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-item {\n");
      out.write("                padding: 12px 15px;\n");
      out.write("                border-bottom: 1px solid #f0f0f0;\n");
      out.write("                cursor: pointer;\n");
      out.write("                transition: all 0.2s ease;\n");
      out.write("                display: flex;\n");
      out.write("                align-items: center;\n");
      out.write("                gap: 10px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-item:hover {\n");
      out.write("                background-color: #f8f9fa;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-item.active {\n");
      out.write("                background-color: #007bff;\n");
      out.write("                color: white;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-item.active .text-muted {\n");
      out.write("                color: rgba(255, 255, 255, 0.8) !important;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-avatar {\n");
      out.write("                width: 40px;\n");
      out.write("                height: 40px;\n");
      out.write("                background: #007bff;\n");
      out.write("                border-radius: 50%;\n");
      out.write("                display: flex;\n");
      out.write("                align-items: center;\n");
      out.write("                justify-content: center;\n");
      out.write("                color: white;\n");
      out.write("                flex-shrink: 0;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-item.active .customer-avatar {\n");
      out.write("                background: rgba(255, 255, 255, 0.2);\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-info {\n");
      out.write("                flex: 1;\n");
      out.write("                min-width: 0;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-info h6 {\n");
      out.write("                margin: 0;\n");
      out.write("                font-size: 14px;\n");
      out.write("                font-weight: 600;\n");
      out.write("                white-space: nowrap;\n");
      out.write("                overflow: hidden;\n");
      out.write("                text-overflow: ellipsis;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .customer-info small {\n");
      out.write("                font-size: 12px;\n");
      out.write("                opacity: 0.8;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .unread-indicator {\n");
      out.write("                width: 8px;\n");
      out.write("                height: 8px;\n");
      out.write("                background: #dc3545;\n");
      out.write("                border-radius: 50%;\n");
      out.write("                flex-shrink: 0;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-area {\n");
      out.write("                border: 1px solid #e0e0e0;\n");
      out.write("                border-radius: 8px;\n");
      out.write("                height: 500px;\n");
      out.write("                display: flex;\n");
      out.write("                flex-direction: column;\n");
      out.write("                overflow: hidden;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-header {\n");
      out.write("                padding: 15px 20px;\n");
      out.write("                border-bottom: 1px solid #e0e0e0;\n");
      out.write("                background: #f8f9fa;\n");
      out.write("                display: flex;\n");
      out.write("                justify-content: space-between;\n");
      out.write("                align-items: center;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-messages {\n");
      out.write("                flex: 1;\n");
      out.write("                padding: 15px;\n");
      out.write("                overflow-y: auto;\n");
      out.write("                overflow-x: hidden;\n");
      out.write("                background: #fafafa;\n");
      out.write("                max-height: 350px;\n");
      out.write("                scroll-behavior: smooth;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            /* Custom scrollbar cho staff chat */\n");
      out.write("            .chat-messages::-webkit-scrollbar {\n");
      out.write("                width: 8px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-messages::-webkit-scrollbar-track {\n");
      out.write("                background: #f1f1f1;\n");
      out.write("                border-radius: 4px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-messages::-webkit-scrollbar-thumb {\n");
      out.write("                background: #c1c1c1;\n");
      out.write("                border-radius: 4px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-messages::-webkit-scrollbar-thumb:hover {\n");
      out.write("                background: #a8a8a8;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-messages::after {\n");
      out.write("                content: \"\";\n");
      out.write("                display: table;\n");
      out.write("                clear: both;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .empty-chat {\n");
      out.write("                height: 100%;\n");
      out.write("                display: flex;\n");
      out.write("                flex-direction: column;\n");
      out.write("                align-items: center;\n");
      out.write("                justify-content: center;\n");
      out.write("                text-align: center;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .staff-message {\n");
      out.write("                margin-bottom: 15px;\n");
      out.write("                display: flex;\n");
      out.write("                gap: 10px;\n");
      out.write("                width: 100%;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .staff-message.sent {\n");
      out.write("                flex-direction: row-reverse;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .staff-message.sent .message-bubble {\n");
      out.write("                background: #007bff;\n");
      out.write("                color: white;\n");
      out.write("                border-radius: 18px 18px 4px 18px;\n");
      out.write("                float: right;\n");
      out.write("                clear: both;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .staff-message.received .message-bubble {\n");
      out.write("                background: white;\n");
      out.write("                color: #333;\n");
      out.write("                border: 1px solid #e0e0e0;\n");
      out.write("                border-radius: 18px 18px 18px 4px;\n");
      out.write("                float: left;\n");
      out.write("                clear: both;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .message-bubble {\n");
      out.write("                max-width: 85%;\n");
      out.write("                padding: 12px 16px;\n");
      out.write("                word-wrap: break-word;\n");
      out.write("                word-break: break-word;\n");
      out.write("                overflow-wrap: break-word;\n");
      out.write("                white-space: pre-wrap;\n");
      out.write("                font-size: 14px;\n");
      out.write("                line-height: 1.4;\n");
      out.write("                display: inline-block;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .message-time {\n");
      out.write("                font-size: 11px;\n");
      out.write("                color: #999;\n");
      out.write("                margin-top: 6px;\n");
      out.write("                text-align: center;\n");
      out.write("                font-style: italic;\n");
      out.write("                opacity: 0.7;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-input {\n");
      out.write("                padding: 15px 20px;\n");
      out.write("                border-top: 1px solid #e0e0e0;\n");
      out.write("                background: white;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-input .input-group {\n");
      out.write("                gap: 10px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-input input {\n");
      out.write("                border-radius: 20px;\n");
      out.write("                border: 1px solid #ddd;\n");
      out.write("                padding: 10px 15px;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            .chat-input button {\n");
      out.write("                border-radius: 50%;\n");
      out.write("                width: 40px;\n");
      out.write("                height: 40px;\n");
      out.write("                display: flex;\n");
      out.write("                align-items: center;\n");
      out.write("                justify-content: center;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            #staff-connection-status.bg-success {\n");
      out.write("                background-color: #28a745 !important;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            #staff-connection-status.bg-warning {\n");
      out.write("                background-color: #ffc107 !important;\n");
      out.write("                color: #212529 !important;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            #staff-connection-status.bg-danger {\n");
      out.write("                background-color: #dc3545 !important;\n");
      out.write("            }\n");
      out.write("        </style>\n");
      out.write("\n");
      out.write("        <script>\n");
      out.write("            let staffStompClient = null;\n");
      out.write("            let staffCurrentUserId = null;\n");
      out.write("            let staffCurrentUserType = 'STAFF';\n");
      out.write("            let selectedCustomerId = null;\n");
      out.write("            let customerListData = [];\n");
      out.write("\n");
      out.write("            // Khởi tạo staff chat\n");
      out.write("            function initStaffChat(userId, userType) {\n");
      out.write("                staffCurrentUserId = userId;\n");
      out.write("                staffCurrentUserType = userType;\n");
      out.write("\n");
      out.write("                if (userType === 'STAFF') {\n");
      out.write("                    connectStaffChat();\n");
      out.write("                    loadCustomerList();\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Kết nối WebSocket cho staff\n");
      out.write("            function connectStaffChat() {\n");
      out.write("                const statusElement = document.getElementById('staff-connection-status');\n");
      out.write("                statusElement.textContent = 'Đang kết nối...';\n");
      out.write("                statusElement.className = 'badge bg-warning';\n");
      out.write("\n");
      out.write("                console.log('🔌 Connecting staff chat WebSocket for user:', staffCurrentUserId);\n");
      out.write("\n");
      out.write("                const socket = new SockJS('/ws-chat');\n");
      out.write("                staffStompClient = Stomp.over(socket);\n");
      out.write("\n");
      out.write("                staffStompClient.connect({}, function (frame) {\n");
      out.write("                    console.log('✅ Staff chat connected:', frame);\n");
      out.write("\n");
      out.write("                    // Subscribe để nhận tin nhắn\n");
      out.write("                    const subscriptionUrl = '/user/' + staffCurrentUserId + '/queue/messages';\n");
      out.write("                    console.log('📡 Subscribing to:', subscriptionUrl);\n");
      out.write("\n");
      out.write("                    staffStompClient.subscribe(subscriptionUrl, function (message) {\n");
      out.write("                        console.log('📩 Staff received message:', message.body);\n");
      out.write("                        const messageData = JSON.parse(message.body);\n");
      out.write("                        handleStaffIncomingMessage(messageData);\n");
      out.write("                    });\n");
      out.write("\n");
      out.write("                    // Cập nhật trạng thái kết nối\n");
      out.write("                    statusElement.textContent = 'Đã kết nối';\n");
      out.write("                    statusElement.className = 'badge bg-success';\n");
      out.write("\n");
      out.write("                    // Enable input nếu đã chọn customer\n");
      out.write("                    if (selectedCustomerId) {\n");
      out.write("                        enableStaffInput();\n");
      out.write("                    }\n");
      out.write("\n");
      out.write("                }, function (error) {\n");
      out.write("                    console.error('❌ Staff chat connection error:', error);\n");
      out.write("                    statusElement.textContent = 'Mất kết nối';\n");
      out.write("                    statusElement.className = 'badge bg-danger';\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Load danh sách customer\n");
      out.write("            function loadCustomerList() {\n");
      out.write("                console.log('🔍 Loading customer list...');\n");
      out.write("                fetch('/api/chat/customers')\n");
      out.write("                    .then(response => {\n");
      out.write("                        console.log('📡 Customer API response status:', response.status);\n");
      out.write("                        return response.json();\n");
      out.write("                    })\n");
      out.write("                    .then(customers => {\n");
      out.write("                        console.log('👥 Customers received:', customers);\n");
      out.write("                        customerListData = customers;\n");
      out.write("                        displayCustomerList(customers);\n");
      out.write("                    })\n");
      out.write("                    .catch(error => {\n");
      out.write("                        console.error('❌ Error loading customers:', error);\n");
      out.write("                        document.getElementById('customer-list').innerHTML = `\n");
      out.write("                                <div class=\"text-center p-3 text-danger\">\n");
      out.write("                                    <i class=\"fas fa-exclamation-triangle fa-2x mb-2\"></i>\n");
      out.write("                                    <p>Không thể tải danh sách khách hàng</p>\n");
      out.write("                                    <small>Error: ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${error.message}", java.lang.String.class, (jakarta.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("</small>\n");
      out.write("                                </div>\n");
      out.write("                            `;\n");
      out.write("                    });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Hiển thị danh sách customer\n");
      out.write("            function displayCustomerList(customers) {\n");
      out.write("                const listContainer = document.getElementById('customer-list');\n");
      out.write("\n");
      out.write("                if (customers.length === 0) {\n");
      out.write("                    listContainer.innerHTML = `\n");
      out.write("                            <div class=\"text-center p-3 text-muted\">\n");
      out.write("                                <i class=\"fas fa-users fa-2x mb-2\"></i>\n");
      out.write("                                <p>Chưa có khách hàng nào</p>\n");
      out.write("                            </div>\n");
      out.write("                        `;\n");
      out.write("                    return;\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                listContainer.innerHTML = customers.map(customer =>\n");
      out.write("                    '<div class=\"customer-item\" onclick=\"selectCustomer(' + customer.id + ', \\'' + customer.fullName + '\\', \\'' + customer.email + '\\')\">' +\n");
      out.write("                    '<div class=\"customer-avatar\">' +\n");
      out.write("                    '<i class=\"fas fa-user\"></i>' +\n");
      out.write("                    '</div>' +\n");
      out.write("                    '<div class=\"customer-info\">' +\n");
      out.write("                    '<h6>' + customer.fullName + '</h6>' +\n");
      out.write("                    '<small class=\"text-muted\">' + customer.email + '</small>' +\n");
      out.write("                    '</div>' +\n");
      out.write("                    '</div>'\n");
      out.write("                ).join('');\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Chọn customer để chat\n");
      out.write("            function selectCustomer(customerId, customerName, customerEmail) {\n");
      out.write("                // Remove active class from all items\n");
      out.write("                document.querySelectorAll('.customer-item').forEach(item => {\n");
      out.write("                    item.classList.remove('active');\n");
      out.write("                });\n");
      out.write("\n");
      out.write("                // Add active class to selected item\n");
      out.write("                event.currentTarget.classList.add('active');\n");
      out.write("\n");
      out.write("                selectedCustomerId = customerId;\n");
      out.write("\n");
      out.write("                // Update chat header\n");
      out.write("                document.getElementById('selected-customer-name').textContent = customerName;\n");
      out.write("                document.getElementById('selected-customer-email').textContent = customerEmail;\n");
      out.write("                document.getElementById('chat-header').style.display = 'flex';\n");
      out.write("                document.getElementById('staff-chat-input').style.display = 'block';\n");
      out.write("\n");
      out.write("                // Clear messages and load history\n");
      out.write("                const messagesContainer = document.getElementById('staff-chat-messages');\n");
      out.write("                messagesContainer.innerHTML = '';\n");
      out.write("\n");
      out.write("                // Enable input if connected\n");
      out.write("                if (staffStompClient && staffStompClient.connected) {\n");
      out.write("                    enableStaffInput();\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                // Load chat history for this customer (from any staff)\n");
      out.write("                loadCustomerChatHistory(customerId);\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Load lịch sử chat của customer với bất kỳ staff nào\n");
      out.write("            function loadCustomerChatHistory(customerId) {\n");
      out.write("                console.log('📚 Loading chat history for customer:', customerId);\n");
      out.write("                fetch('/api/chat/customer-messages/' + customerId)\n");
      out.write("                    .then(response => response.json())\n");
      out.write("                    .then(messages => {\n");
      out.write("                        console.log('📝 Customer chat history loaded:', messages.length, 'messages');\n");
      out.write("                        messages.forEach(message => {\n");
      out.write("                            displayStaffMessage(message, false);\n");
      out.write("                        });\n");
      out.write("                        scrollStaffChatToBottom();\n");
      out.write("                    })\n");
      out.write("                    .catch(error => {\n");
      out.write("                        console.error('❌ Error loading customer chat history:', error);\n");
      out.write("                    });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Hiển thị tin nhắn trong staff chat\n");
      out.write("            function displayStaffMessage(message, isNew = true) {\n");
      out.write("                const messagesContainer = document.getElementById('staff-chat-messages');\n");
      out.write("                const messageWrapper = document.createElement('div');\n");
      out.write("                messageWrapper.style.width = '100%';\n");
      out.write("                messageWrapper.style.marginBottom = '10px';\n");
      out.write("                messageWrapper.style.display = 'block';\n");
      out.write("\n");
      out.write("                const messageDiv = document.createElement('div');\n");
      out.write("\n");
      out.write("                const isSent = message.senderId == staffCurrentUserId;\n");
      out.write("                messageDiv.className = 'staff-message ' + (isSent ? 'sent' : 'received');\n");
      out.write("\n");
      out.write("                const avatar = isSent ? `\n");
      out.write("                        <div class=\"customer-avatar\" style=\"background: #28a745;\">\n");
      out.write("                            <i class=\"fas fa-user-tie\"></i>\n");
      out.write("                        </div>\n");
      out.write("                    ` : `\n");
      out.write("                        <div class=\"customer-avatar\">\n");
      out.write("                            <i class=\"fas fa-user\"></i>\n");
      out.write("                        </div>\n");
      out.write("                    `;\n");
      out.write("\n");
      out.write("                // Escape HTML và xử lý text properly\n");
      out.write("                const messageText = escapeStaffHtml(message.message);\n");
      out.write("                const formattedTime = new Date(message.timestamp).toLocaleTimeString('vi-VN', {\n");
      out.write("                    hour: '2-digit',\n");
      out.write("                    minute: '2-digit'\n");
      out.write("                });\n");
      out.write("\n");
      out.write("                messageDiv.innerHTML = `\n");
      out.write("                        ` + avatar + `\n");
      out.write("                        <div>\n");
      out.write("                            <div class=\"message-bubble\">\n");
      out.write("                                <div style=\"word-break: break-word; overflow-wrap: break-word; hyphens: none;\">` + messageText + `</div>\n");
      out.write("                            </div>\n");
      out.write("                            <div class=\"message-time\">\n");
      out.write("                                ` + formattedTime + `\n");
      out.write("                                ` + (isSent && message.isRead ? ' ✓✓' : '') + `\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    `;\n");
      out.write("\n");
      out.write("                messageWrapper.appendChild(messageDiv);\n");
      out.write("                messagesContainer.appendChild(messageWrapper);\n");
      out.write("\n");
      out.write("                if (isNew) {\n");
      out.write("                    scrollStaffChatToBottom();\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Helper function để escape HTML cho staff\n");
      out.write("            function escapeStaffHtml(unsafe) {\n");
      out.write("                if (!unsafe) return '';\n");
      out.write("                return unsafe\n");
      out.write("                    .replace(/&/g, \"&amp;\")\n");
      out.write("                    .replace(/</g, \"&lt;\")\n");
      out.write("                    .replace(/>/g, \"&gt;\")\n");
      out.write("                    .replace(/\"/g, \"&quot;\")\n");
      out.write("                    .replace(/'/g, \"&#039;\");\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Gửi tin nhắn từ staff\n");
      out.write("            function sendStaffMessage() {\n");
      out.write("                const input = document.getElementById('staff-message-input');\n");
      out.write("                const message = input.value.trim();\n");
      out.write("\n");
      out.write("                if (message && staffStompClient && selectedCustomerId) {\n");
      out.write("                    const messageData = {\n");
      out.write("                        senderId: staffCurrentUserId,\n");
      out.write("                        receiverId: selectedCustomerId,\n");
      out.write("                        message: message,\n");
      out.write("                        senderType: 'STAFF',\n");
      out.write("                        receiverType: 'CUSTOMER'\n");
      out.write("                    };\n");
      out.write("\n");
      out.write("                    // Temporarily disable button và clear input\n");
      out.write("                    const sendButton = document.getElementById('staff-send-button');\n");
      out.write("                    sendButton.disabled = true;\n");
      out.write("                    input.value = '';\n");
      out.write("\n");
      out.write("                    staffStompClient.send(\"/app/chat.sendMessage\", {}, JSON.stringify(messageData));\n");
      out.write("\n");
      out.write("                    // Hiển thị tin nhắn vừa gửi lên UI ngay lập tức\n");
      out.write("                    displayStaffMessage({\n");
      out.write("                        senderId: staffCurrentUserId,\n");
      out.write("                        message: message,\n");
      out.write("                        timestamp: new Date()\n");
      out.write("                    }, true);\n");
      out.write("\n");
      out.write("                    // Re-enable button sau 1 giây\n");
      out.write("                    setTimeout(() => {\n");
      out.write("                        sendButton.disabled = false;\n");
      out.write("                    }, 1000);\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Xử lý tin nhắn đến cho staff\n");
      out.write("            function handleStaffIncomingMessage(messageData) {\n");
      out.write("                // Nếu đang chat với customer này, hiển thị tin nhắn\n");
      out.write("                if (selectedCustomerId && messageData.senderId == selectedCustomerId) {\n");
      out.write("                    displayStaffMessage(messageData);\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                // Update notification badge if needed\n");
      out.write("                // This could be enhanced to show unread count per customer\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Enable staff input\n");
      out.write("            function enableStaffInput() {\n");
      out.write("                document.getElementById('staff-message-input').disabled = false;\n");
      out.write("                document.getElementById('staff-send-button').disabled = false;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Refresh customer list\n");
      out.write("            function refreshCustomerList() {\n");
      out.write("                loadCustomerList();\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Scroll to bottom\n");
      out.write("            function scrollStaffChatToBottom() {\n");
      out.write("                const messagesContainer = document.getElementById('staff-chat-messages');\n");
      out.write("                if (messagesContainer) {\n");
      out.write("                    const scrollHeight = messagesContainer.scrollHeight;\n");
      out.write("                    const height = messagesContainer.clientHeight;\n");
      out.write("                    const maxScrollTop = scrollHeight - height;\n");
      out.write("\n");
      out.write("                    // Smooth scroll animation\n");
      out.write("                    messagesContainer.scrollTo({\n");
      out.write("                        top: maxScrollTop,\n");
      out.write("                        behavior: 'smooth'\n");
      out.write("                    });\n");
      out.write("\n");
      out.write("                    // Fallback for older browsers\n");
      out.write("                    setTimeout(() => {\n");
      out.write("                        messagesContainer.scrollTop = maxScrollTop;\n");
      out.write("                    }, 100);\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            // Search customers\n");
      out.write("            document.addEventListener('DOMContentLoaded', function () {\n");
      out.write("                const searchInput = document.getElementById('customer-search');\n");
      out.write("                if (searchInput) {\n");
      out.write("                    searchInput.addEventListener('input', function (e) {\n");
      out.write("                        const searchTerm = e.target.value.toLowerCase();\n");
      out.write("                        const filteredCustomers = customerListData.filter(customer =>\n");
      out.write("                            customer.fullName.toLowerCase().includes(searchTerm) ||\n");
      out.write("                            customer.email.toLowerCase().includes(searchTerm)\n");
      out.write("                        );\n");
      out.write("                        displayCustomerList(filteredCustomers);\n");
      out.write("                    });\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                // Enter to send message\n");
      out.write("                const messageInput = document.getElementById('staff-message-input');\n");
      out.write("                if (messageInput) {\n");
      out.write("                    messageInput.addEventListener('keypress', function (e) {\n");
      out.write("                        if (e.key === 'Enter') {\n");
      out.write("                            sendStaffMessage();\n");
      out.write("                        }\n");
      out.write("                    });\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        </script>\n");
      out.write("\n");
      out.write("        <script>\n");
      out.write("            // Check staff access on page load and initialize chat\n");
      out.write("            document.addEventListener('DOMContentLoaded', function () {\n");
      out.write("                checkPageAccess('STAFF');\n");
      out.write("\n");
      out.write("                // Initialize staff chat with Staff Member (ID: 8) from session\n");
      out.write("                console.log('🔍 Initializing staff chat for logged in staff...');\n");
      out.write("\n");
      out.write("                // Staff info from login session: Staff Member (staff@gundam.com) - ID: 8\n");
      out.write("                const staffUserId = 8; // Staff Member ID from database\n");
      out.write("                const staffUserType = 'STAFF';\n");
      out.write("\n");
      out.write("                // Set sessionStorage for consistency\n");
      out.write("                sessionStorage.setItem('userId', staffUserId.toString());\n");
      out.write("                sessionStorage.setItem('userType', staffUserType);\n");
      out.write("                sessionStorage.setItem('userName', 'Staff Member');\n");
      out.write("                sessionStorage.setItem('userEmail', 'staff@gundam.com');\n");
      out.write("\n");
      out.write("                console.log('✅ Staff session set:', {\n");
      out.write("                    userId: staffUserId,\n");
      out.write("                    userType: staffUserType,\n");
      out.write("                    userName: 'Staff Member',\n");
      out.write("                    userEmail: 'staff@gundam.com'\n");
      out.write("                });\n");
      out.write("\n");
      out.write("                // Initialize staff chat\n");
      out.write("                initStaffChat(staffUserId, staffUserType);\n");
      out.write("                console.log('✅ Staff chat initialized with ID:', staffUserId);\n");
      out.write("            });\n");
      out.write("        </script>\n");
      out.write("    </body>\n");
      out.write("\n");
      out.write("    </html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof jakarta.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
